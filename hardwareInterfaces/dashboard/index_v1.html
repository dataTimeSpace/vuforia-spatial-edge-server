<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link rel="stylesheet" type="text/css" href="index.css">
</head>
<body>


<div id="container">
    <div class="region top left" id="topLeft">
        <div class="centerContentsOuter">
            <div class="centerContentsInner blue inactive">
                No Connection
            </div>
        </div>
    </div>

    <div class="region top right" id="topRight">
        <div class="centerContentsOuter">
            <div class="centerContentsInner blue inactive">
                No Connection
            </div>
        </div>
    </div>

    <div class="region bottom left" id="bottomLeft">
        <div class="centerContentsOuter">
            <div class="centerContentsInner blue inactive">
                No Connection
            </div>
        </div>
    </div>

    <div class="region bottom right">
        <div class="centerContentsOuter">
            <div class="centerContentsInner blue">
                <img class="marker center" src="marker.jpg">
            </div>
        </div>
    </div>

</div>

<!--<div class="centerContents"><img class="marker center" src="../timer/marker.jpg"></div>-->

<script src="/socket.io/socket.io.js"></script>
<script>
    var socket = io();

//    var counter = 0;

//    var nodes = ["topLeft", "topRight", "bottomLeft"];

    var container = document.getElementById("container");

//    var createdPanels = createPanels(3,3);

    function createPanels(rows, columns) {
        var panelArray = [];
        for (var r=0; r < rows; r++) {
            for (var c = 0; c < columns; c++) {
                var newPanel = document.createElement("div");
                newPanel.classList.add("region");
                panelArray.push(newPanel);


            }
        }
    }

    function getPanelContents(nodeName) {
        return document.getElementById(nodeName).firstElementChild.firstElementChild;
    }

    function activatePanel(nodeName, shouldBeActive) {
        var panelContents = getPanelContents(nodeName);

        if (shouldBeActive) {
            panelContents.classList.remove("inactive");
            panelContents.classList.add("active");
            panelContents.innerHTML = "Connected";
        } else {
            panelContents.classList.remove("active");
            panelContents.classList.add("inactive");
            panelContents.innerHTML = "No Connection";

        }

    }

    function updatePanelText(nodeName, value) {
        getPanelContents(nodeName).innerHTML = value.toFixed(2);

        getPanelContents(nodeName).classList.remove("greenText");
        getPanelContents(nodeName).classList.remove("redText");
        getPanelContents(nodeName).classList.remove("whiteText");

        if (value > 0) {
            getPanelContents(nodeName).classList.add("greenText");
        } else if (value === 0) {
            getPanelContents(nodeName).classList.add("whiteText");
        } else {
            getPanelContents(nodeName).classList.add("redText");
        }
    }

    socket.on('dashboard', function(msg) {

        var nodeName = msg.nodeName;
        var action = msg.action;

        console.log(nodeName, action);

        if (msg.action === "connect") {
            console.log(msg.data);

            if (msg.data.added === true) {
                console.log("connected!");
                activatePanel(msg.data.nameNodeB, true);

            } else {
                console.log("disconnected!");
                activatePanel(msg.data.nameNodeB, false);

            }

        }

//        if (msg.action === "disconnect") {
//            console.log("disconnected!");
//        }

        if (msg.action === "update") {
            console.log("update!");
            console.log(msg.data);
//            counter += 1;
//            document.getElementById(nodeName).innerHTML = counter;

//            getPanelContents(nodeName).innerHTML = counter;

            updatePanelText(nodeName, msg.data.value);

//            getPanelContents(nodeName).innerHTML = msg.data.value.toFixed(2);

//            nodes.forEach(function(otherNode) {
//                activatePanel(otherNode, otherNode === nodeName);
//            });
//            activatePanel(nodeName, true);
        }

    });
</script>
</body>
</html>
