<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GridMax</title>
    <link rel="stylesheet" type="text/css" href="index.css">
</head>
<body>

<div id="container"></div>

<!--<script src="/socket.io/socket.io.js"></script>-->
<script>
//    var socket = io();

    var columns = 5;
    var rows = 3;

    var container = document.getElementById("container");
    container.style.width = "80%";
    container.style.height = "1400px";

    //    var createdPanels = createPanels(3,4);

    var panelConnections = [];

    function getNodeColumn(i) {
        return i % columns;
    }

    function getNodeRow(i) {
        return Math.floor(i / columns);
    }

    var createdPanels = createPanels(rows, columns);

    function createPanels(rows, columns) {

        var panelArray = [];

        for (var r = 0; r < rows; r++) {
            for (var c = 0; c < columns; c++) {

                var newPanel = document.createElement("div");
                newPanel.classList.add("region");
                newPanel.id = getIdForPanel(r, c);
                newPanel.style.width = ((1.0 / columns) * 100) + "%";
                newPanel.style.height = ((1.0 / rows) * 100) + "%";
                newPanel.style.left = (((1.0 / columns) * 100) * c) + "%";
                newPanel.style.top = (((1.0 / rows) * 100) * r) + "%";

                container.appendChild(newPanel);

                newPanel.addEventListener, function(e) {
                   toggleConnected(e.currentTarget);
                });

                var centerContentsOuter = document.createElement("div");
                centerContentsOuter.className = "centerContentsOuter";
                newPanel.appendChild(centerContentsOuter);

                var centerContentsInner = document.createElement("div");
                centerContentsInner.classList.add("centerContentsInner");
                centerContentsInner.classList.add("blue");
                centerContentsOuter.appendChild(centerContentsInner);

                panelConnections.push(false);
                activatePanel(getIdForPanel(r, c), false);

                panelArray.push(newPanel);
            }
        }

        return panelArray;
    }

    function toggleConnected(panel) {
        activatePanel(panel.id, !getPanelContents(panel.id).classList.contains("active"));
    }

    function getIdForPanel(row, column) {
        return "panel_row" + row + "_col" + column;
    }

    function indexFromPanelId(panelId) {
        var r = parseInt(panelId.split("_")[1].slice(3));
        var c = parseInt(panelId.split("_")[2].slice(3));
        return r * columns + c;
    }

    function getPanelContents(nodeName) {
        return document.getElementById(nodeName).firstElementChild.firstElementChild;
    }

    function activatePanel(nodeName, shouldBeActive) {
        var panelContents = getPanelContents(nodeName);

        if (shouldBeActive) {
            panelContents.classList.remove("inactive");
            panelContents.classList.add("active");
            panelContents.innerHTML = "Connected";
        } else {
            panelContents.classList.remove("active");
            panelContents.classList.add("inactive");
            panelContents.innerHTML = "No Connection";
        }

        panelContents.classList.remove("greenText");
        panelContents.classList.remove("redText");
        panelContents.classList.remove("whiteText");

        panelContents.classList.remove("largeText");
        panelContents.classList.add("smallText");

        panelConnections[indexFromPanelId(nodeName)] = shouldBeActive;
//        console.log(panelConnections);

    }

//    function growPanel(panelId) {
//
//    }

//    function getAdjacentPanels(includeLeft, includeRight, includeUp, includeDown) {
//
//    }

    function updatePanelText(nodeName, value) {
        var panelContents = getPanelContents(nodeName);

        panelContents.innerHTML = value.toFixed(2);// + '\n' + data.nameObjectA + " - " + data.nameNodeA;

        panelContents.classList.remove("greenText");
        panelContents.classList.remove("redText");
        panelContents.classList.remove("whiteText");

        if (value > 0) {
            panelContents.classList.add("greenText");
        } else if (value === 0) {
            panelContents.classList.add("whiteText");
        } else {
            panelContents.classList.add("redText");
        }

        panelContents.classList.remove("smallText");
        panelContents.classList.add("largeText");

    }

//    socket.on('dashboard', function(msg) {
//
//        var nodeName = msg.nodeName;
//        var action = msg.action;
//
//        console.log(nodeName, action);
//
//        if (msg.action === "connect") {
//            console.log(msg.data);
//
//            if (msg.data.added === true) {
//                console.log("connected!");
//                activatePanel(msg.data.nameNodeB, true);
//
//            } else {
//                console.log("disconnected!");
//                activatePanel(msg.data.nameNodeB, false);
//
//            }
//
//        }
//
//        if (msg.action === "update") {
//            console.log("update!");
//            console.log(msg.data);
//            updatePanelText(nodeName, msg.data.value);
//        }
//
//    });
</script>
</body>
</html>
