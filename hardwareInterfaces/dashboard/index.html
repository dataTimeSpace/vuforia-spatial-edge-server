<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link rel="stylesheet" type="text/css" href="index.css">
</head>
<body>


<div id="container">
    <div class="region top left" id="topLeft">
        <div class="centerContentsOuter">
            <div class="centerContentsInner blue inactive">
                No Connection
            </div>
        </div>
    </div>

    <div class="region top right" id="topRight">
        <div class="centerContentsOuter">
            <div class="centerContentsInner blue inactive">
                No Connection
            </div>
        </div>
    </div>

    <div class="region bottom left" id="bottomLeft">
        <div class="centerContentsOuter">
            <div class="centerContentsInner blue inactive">
                No Connection
            </div>
        </div>
    </div>

    <div class="region bottom right">
        <div class="centerContentsOuter">
            <div class="centerContentsInner blue">
                <img class="marker center" src="marker.jpg">
            </div>
        </div>
    </div>

</div>

<!--<div class="centerContents"><img class="marker center" src="../timer/marker.jpg"></div>-->

<script src="/socket.io/socket.io.js"></script>
<script>
    var socket = io();

    var counter = 0;

    var nodes = ["topLeft", "topRight", "bottomLeft"];


    function getPanelContents(nodeName) {
        return document.getElementById(nodeName).firstElementChild.firstElementChild;
    }

    function activatePanel(nodeName, shouldBeActive) {
        var panelContents = getPanelContents(nodeName);

        if (shouldBeActive) {
            panelContents.classList.remove("inactive");
            panelContents.classList.add("active");
        } else {
            panelContents.classList.remove("active");
            panelContents.classList.add("inactive");
        }

    }

    socket.on('dashboard', function(msg) {

        var nodeName = msg.nodeName;
        var action = msg.action;

        console.log(nodeName, action);

        if (msg.action === "connect") {
            console.log("connected!");
        }

        if (msg.action === "disconnect") {
            console.log("disconnected!");
        }

        if (msg.action === "update") {
            console.log("update!");
            counter += 1;
//            document.getElementById(nodeName).innerHTML = counter;

            getPanelContents(nodeName).innerHTML = counter;

            nodes.forEach(function(otherNode) {
                activatePanel(otherNode, otherNode === nodeName);
            });
//            activatePanel(nodeName, true);
        }

    });
</script>
</body>
</html>
